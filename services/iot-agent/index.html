<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.112.7"><meta name=generator content="Relearn 5.7.0+tip"><meta name=description content><title>IoT Agent :: Diwise for Developers</title><link href=/services/iot-agent/index.xml rel=alternate type=application/rss+xml title="IoT Agent :: Diwise for Developers"><link href=/images/favicon.ico?1685965235 rel=icon type=image/x-icon><link href=/css/fontawesome-all.min.css?1685965235 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css?1685965235 rel=stylesheet></noscript><link href=/css/featherlight.min.css?1685965235 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css?1685965235 rel=stylesheet></noscript><link href=/css/auto-complete.css?1685965235 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/auto-complete.css?1685965235 rel=stylesheet></noscript><link href=/css/perfect-scrollbar.min.css?1685965235 rel=stylesheet><link href=/css/nucleus.css?1685965235 rel=stylesheet><link href=/css/fonts.css?1685965235 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css?1685965235 rel=stylesheet></noscript><link href=/css/theme.css?1685965235 rel=stylesheet><link href=/css/theme-my-custom-variant.css?1685965235 rel=stylesheet id=variant-style><link href=/css/ie.css?1685965235 rel=stylesheet><link href=/css/variant.css?1685965235 rel=stylesheet><link href=/css/print.css?1685965235 rel=stylesheet media=print><script src=/js/url.js?1685965235></script>
<script src=/js/variant.js?1685965235></script>
<script>window.index_js_url="/index.search.js";var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \"{0}\"",window.T_N_results_found="{1} results found for \"{0}\"",baseUriFull="https://diwise.github.io/",window.variants&&variants.init(["my-custom-variant"])</script><script src=/js/jquery.min.js?1685965235 defer></script></head><body class="mobile-support html" data-url=/services/iot-agent/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable dir=ltr><div><div class=navigation><a class="nav nav-next" href=/services/iot-core/index.html title="IoT Core (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev" href=/services/context-broker/index.html title="Context Broker (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title='Table of Contents (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Diwise</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/services/index.html><span itemprop=name>Microservices</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>IoT Agent</span><meta itemprop=position content="3"></li></ol></div><div class="default-animation progress"><div class=toc-wrapper dir=ltr><nav id=TableOfContents><ul><li><a href=#description>Description</a></li><li><a href=#architecture>Architecture</a><ul><li><a href=#diagrams>Diagrams</a></li><li><a href=#endpoints>Endpoints</a></li></ul></li><li><a href=#links>Links</a></li><li><a href=#run>Run</a><ul><li><a href=#configuration>Configuration</a></li></ul></li><li><a href=#operations>Operations</a><ul><li><a href=#observability-and-monitoring>Observability and Monitoring</a></li><li><a href=#run-book>Run Book</a></li></ul></li><li><a href=#faq>FAQ</a></li><li><a href=#license>License</a></li></ul></nav></div></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags><div class=tags><a class=tag-link href=/tags/iot/index.html>iot</a></div></div><article class=default><h1 id=iot-agent>IoT Agent</h1><h2 id=description>Description</h2><p>The iot-agent service is responsible for connecting to an underlying platform via MQTT and ingest messages from the topics it subscribes to.</p><h2 id=architecture>Architecture</h2><h3 id=diagrams>Diagrams</h3><div class="mermaid align-center">C4Component
Container_Boundary(b1, "iot-agent") {
Container_Boundary(apib, "API") {
Component(api, "API", "", "handles incoming messages")
}
Container_Boundary(msgp, "Message Processor") {
Component(decoderreg, "Decoder Registry", "", "contains all available decoders")
Component(decoder, "Decoder", "", "decodes incoming sensor specific&lt;br>payloads to internal format")
Component(converterreg, "Converter Registry", "", "contains all available converters")
Component(converter, "Converter", "", "converts internal format&lt;br>to LWM2M SenML")
}
Container_Boundary(evts, "Event Sender") {
Component(sender, "Sender")
}
Component(mqtt-client, "MQTT Client")
}
UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="3")</div><h3 id=endpoints>Endpoints</h3><h4 id=application>Application</h4><p>This service exposes the following application endpoints:</p><table><thead><tr><th>Operation</th><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead><tbody><tr><td>Incoming Message</td><td>POST</td><td>/api/v0/messages</td><td>Accepts incoming message payloads for further processing</td></tr></tbody></table><h4 id=probes>Probes</h4><p>A health endpoint, that can be used by kubernetes probes for instance, is exposed on the default port under /health. A future release will move this endpoint to a separate control and monitoring port.</p><h2 id=links>Links</h2><table><thead><tr><th>Where</th><th>Address</th></tr></thead><tbody><tr><td>Git Hub</td><td><a href=https://github.com/diwise/iot-agent>https://github.com/diwise/iot-agent</a></td></tr></tbody></table><h2 id=run>Run</h2><p>Since the service is distributed as a container image, it can be started using docker or podman. Do note that you must specify a couple of required environment variables though. See the configuration section below for more details.</p><p>This service has a runtime dependency on Keycloak for token management, iot-device-mgmt for device information and RabbitMQ for internal messaging. The latter can optionally be disabled for testing purposes.</p><p>Refer to the default docker compose configuration in <a href=https://github.com/diwise/diwise>https://github.com/diwise/diwise</a> for details on how to start this service in concert with the rest of the platform.</p><h3 id=configuration>Configuration</h3><h4 id=environment-variables>Environment variables</h4><table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>DEV_MGMT_URL</td><td>url</td><td><strong>required</strong></td><td>URL to a service exposing the device management API. Typically an instance of iot-device-mgmt.</td></tr><tr><td>MSG_FWD_ENDPOINT</td><td>url</td><td><strong>required</strong></td><td>An endpoint that incoming messages should be forwarded to. Typically this is /api/v0/messages on the same service.</td></tr><tr><td>OAUTH2_TOKEN_URL</td><td>url</td><td><strong>required</strong></td><td>URL to an Open ID Connect token provider.</td></tr><tr><td>OAUTH2_CLIENT_ID</td><td>string</td><td><strong>required</strong></td><td>The client credentials id to use when requesting a token.</td></tr><tr><td>OAUTH2_CLIENT_SECRET</td><td>string</td><td><strong>required</strong></td><td>The client secret (password) to use when requesting a token.</td></tr><tr><td>APPSERVER_FACADE</td><td>string</td><td>chirpstack</td><td>Configures how to interpret incoming message payloads.</td></tr><tr><td>MQTT_HOST</td><td>hostname</td><td><strong>required</strong></td><td>Specify the MQTT host to connect to.</td></tr><tr><td>MQTT_USER</td><td>string</td><td></td><td>The username (if any) used to authenticate with the MQTT server.</td></tr><tr><td>MQTT_PASSWORD</td><td>string</td><td></td><td>The password (if any) used to authenticate with the MQTT server.</td></tr><tr><td>MQTT_TOPIC_[x]</td><td>string</td><td>at least one required</td><td>Any number of zero indexed MQTT topics that should be subscribed to on successful connect.</td></tr><tr><td>SERVICE_PORT</td><td>integer</td><td>8080</td><td>The port to accept incoming connections on</td></tr></tbody></table><h4 id=command-line-flags>Command line flags</h4><p>This service has no command line flags.</p><h4 id=configuration-files>Configuration files</h4><p>This service has no configuration files.</p><h4 id=security>Security</h4><p>Communication with device management requires a valid access token that will be requested via the OAuth2 token url specified in the configuration.</p><h2 id=operations>Operations</h2><h3 id=observability-and-monitoring>Observability and Monitoring</h3><p>The documented metrics and tracing data below will be generated if the environment variable OTEL_EXPORTER_OTLP_ENDPOINT is set to a valid OTLP collector endpoint such as open telemetry collector.</p><h4 id=logging>Logging</h4><p>All logging is sent to stdout in a structured json format so that it can be filtered and redirected to your logging aggregator of choice. If tracing is enabled the log output will be decorated with the corresponding traceID for easier correlation.</p><h4 id=metrics>Metrics</h4><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>mqtt.messages</td><td>counter</td><td>Total number of received mqtt messages</td></tr></tbody></table><h4 id=tracing>Tracing</h4><p>The following traces are created at the application level:</p><table><thead><tr><th>Span</th><th>Attributes</th><th>Created By</th><th>Description</th></tr></thead><tbody><tr><td>forward-message</td><td><em>none</em></td><td>messagehandler</td><td>Spans the operation from the time the MQTT message handler recieves a message handler, until the forwarding endpoint returns a result.</td></tr><tr><td>incoming-message</td><td><em>none</em></td><td>api</td><td>Spans the operation of processing an incoming message payload.</td></tr><tr><td>find-device-from-deveui</td><td><em>none</em></td><td>device mgmt client</td><td>Spans a request to device management&rsquo;s /api/v0/devices?devEUI=&#171;id&#187; endpoint.</td></tr></tbody></table><h3 id=run-book>Run Book</h3><p>In this section we will list different failure modes for the service, how to detect them based on observability data and how to recover from them.</p><h2 id=faq>FAQ</h2><p>This section is supposed to list questions that get asked frequently by integrators and developers.</p><h2 id=license>License</h2><p>This document is licensed <a href=https://creativecommons.org/licenses/by/3.0/>CC-BY</a></p><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation dir=ltr><div id=header-wrapper class=default-animation><div id=header class=default-animation><img src=/images/diwise-logo.png></div><form action=/search.html method=get><div class="searchbox default-animation"><button type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=search-by>Search</label>
<input data-search-input id=search-by name=search-by class=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div></form><script>var contentLangs=["en"]</script><script src=/js/auto-complete.js?1685965235 defer></script>
<script src=/js/lunr.min.js?1685965235 defer></script>
<script src=/js/lunr.stemmer.support.min.js?1685965235 defer></script>
<script src=/js/lunr.multi.min.js?1685965235 defer></script>
<script src=/js/lunr.en.min.js?1685965235 defer></script>
<script src=/js/search.js?1685965235 defer></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=/index.html><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class=topics><li data-nav-id=/intro/index.html class=dd-item><a href=/intro/index.html><i class='fas fa-info-circle'></i> Introduction</a><ul id=subsections-925e5bfbd01266c727d74ae1db5ab0c6><li data-nav-id=/intro/supported-sensor-types/index.html class=dd-item><a href=/intro/supported-sensor-types/index.html><i class='fas fa-microchip'></i> Supported sensor types</a></li><li data-nav-id=/intro/measurements/index.html class=dd-item><a href=/intro/measurements/index.html><i class='fas fa-ruler'></i> Measurements</a></li><li data-nav-id=/intro/environments/index.html class=dd-item><a href=/intro/environments/index.html><i class='fas fa-map'></i> Environments</a></li></ul></li><li data-nav-id=/architecture/index.html class="dd-item alwaysopen"><a href=/architecture/index.html><i class='far fa-compass'></i> Architecture</a><ul id=subsections-a81d732c785e3254a4a6686c290336fc><li data-nav-id=/architecture/overview/index.html class=dd-item><a href=/architecture/overview/index.html><i class='fas fa-satellite'></i> Overview</a></li><li data-nav-id=/architecture/cip/index.html class=dd-item><a href=/architecture/cip/index.html><i class='fas fa-city'></i> City Information Platform</a></li><li data-nav-id=/architecture/iot/index.html class=dd-item><a href=/architecture/iot/index.html><i class='fas fa-cubes'></i> IoT Platform</a></li></ul></li><li data-nav-id=/services/index.html class="dd-item parent"><a href=/services/index.html><i class='fas fa-cogs'></i> Microservices</a><ul id=subsections-057108a1c1a3662b9db6ab679412fa8f><li data-nav-id=/services/context-broker/index.html class=dd-item><a href=/services/context-broker/index.html><i class='fas fa-sitemap'></i> Context Broker</a></li><li data-nav-id=/services/iot-agent/index.html class="dd-item active"><a href=/services/iot-agent/index.html><i class='fas fa-satellite-dish'></i> IoT Agent</a></li><li data-nav-id=/services/iot-core/index.html class=dd-item><a href=/services/iot-core/index.html><i class='fas fa-arrows-alt'></i> IoT Core</a></li><li data-nav-id=/services/iot-device-mgmt-web/index.html class=dd-item><a href=/services/iot-device-mgmt-web/index.html><i class='fas fa-tablet-alt'></i> IoT Device Dashboard</a></li><li data-nav-id=/services/iot-device-mgmt/index.html class=dd-item><a href=/services/iot-device-mgmt/index.html><i class='fas fa-list'></i> IoT Device Management</a></li><li data-nav-id=/services/iot-events/index.html class=dd-item><a href=/services/iot-events/index.html><i class='fas fa-arrows-alt'></i> IoT Events</a></li><li data-nav-id=/services/iot-transform-fiware/index.html class=dd-item><a href=/services/iot-transform-fiware/index.html><i class='fas fa-random'></i> IoT Transform Fiware</a></li></ul></li><li data-nav-id=/getting-started/index.html class=dd-item><a href=/getting-started/index.html><i class='fas fa-list-ol'></i> Getting Started</a><ul id=subsections-c727fab97b4d77e5b28ce8c448fb9000><li data-nav-id=/getting-started/how-to/index.html class="dd-item alwaysopen"><a href=/getting-started/how-to/index.html><i class='fas fa-chalkboard-teacher'></i> How to</a><ul id=subsections-5b8613b9b40b304158cb159e3894274e><li data-nav-id=/getting-started/how-to/dev-environment/index.html class=dd-item><a href=/getting-started/how-to/dev-environment/index.html><i class='fas fa-laptop-code'></i> Set up development environment</a></li><li data-nav-id=/getting-started/how-to/add-device/index.html class=dd-item><a href=/getting-started/how-to/add-device/index.html><i class='fas fa-plus-square'></i> Add a device</a></li><li data-nav-id=/getting-started/how-to/contribute/index.html class="dd-item alwaysopen"><a href=/getting-started/how-to/contribute/index.html><i class='fas fa-people-carry'></i> Contribute</a><ul id=subsections-7aef710009368ec0313075cac519cb0f><li data-nav-id=/getting-started/how-to/submit-pr/index.html class=dd-item><a href=/getting-started/how-to/submit-pr/index.html><i class='fas fa-code-branch'></i> Submit a pull request</a></li><li data-nav-id=/getting-started/how-to/submit-issues/index.html class=dd-item><a href=/getting-started/how-to/submit-issues/index.html><i class='fas fa-exclamation-triangle'></i> Submit an issue</a></li></ul></li></ul></li></ul></li><li data-nav-id=/deployment/index.html class=dd-item><a href=/deployment/index.html><i class='fas fa-cloud'></i> Deployment</a></li><li data-nav-id=/contact/index.html class=dd-item><a href=/contact/index.html><i class='fas fa-at'></i> Get in touch</a></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=/tags/index.html><i class='fas fa-tags'></i> Tags</a></li></ul></div><div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><div class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-language>Language</label>
<select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></div></li><li id=select-variant-container class=footerVariantSwitch><div class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-variant>Theme</label>
<select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=my-custom-variant value=my-custom-variant selected>My Custom Variant</option></select></div><div class=select-clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><button class=padding onclick=clearHistory()><i class="fas fa-history fa-fw"></i> Clear History</button></li></ul></div><div id=footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=/js/clipboard.min.js?1685965235 defer></script>
<script src=/js/perfect-scrollbar.min.js?1685965235 defer></script>
<script src=/js/featherlight.min.js?1685965235 defer></script>
<script src=/js/jquery.svg.pan.zoom.js?1685965235 defer></script>
<script src=/js/mermaid.min.js?1685965235 defer></script>
<script>window.themeUseMermaid=JSON.parse("{}")</script><script src=/js/theme.js?1685965235 defer></script></body></html>